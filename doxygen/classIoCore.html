<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>URY playd: IoCore Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">URY playd
   </div>
   <div id="projectbrief">C++ minimalist audio player</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classIoCore.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classIoCore-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">IoCore Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The IO core, which services input, routes responses, and executes the <a class="el" href="classPlayer.html" title="A Player contains a loaded audio file and a command API for manipulating it. ">Player</a> update routine periodically.  
 <a href="classIoCore.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="io_8hpp_source.html">io.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for IoCore:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="classIoCore__inherit__graph.svg" width="120" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for IoCore:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="classIoCore__coll__graph.svg" width="100%" height="454"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7d61a2bcec6a72a8aa0496964bc821a3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a7d61a2bcec6a72a8aa0496964bc821a3">IoCore</a> (<a class="el" href="classPlayer.html">Player</a> &amp;<a class="el" href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">player</a>)</td></tr>
<tr class="memdesc:a7d61a2bcec6a72a8aa0496964bc821a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs an <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a>.  <a href="#a7d61a2bcec6a72a8aa0496964bc821a3">More...</a><br /></td></tr>
<tr class="separator:a7d61a2bcec6a72a8aa0496964bc821a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a661899bca5e0528022c981c5e967abad"><td class="memItemLeft" align="right" valign="top"><a id="a661899bca5e0528022c981c5e967abad"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a661899bca5e0528022c981c5e967abad">IoCore</a> (const <a class="el" href="classIoCore.html">IoCore</a> &amp;)=delete</td></tr>
<tr class="memdesc:a661899bca5e0528022c981c5e967abad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deleted copy constructor. <br /></td></tr>
<tr class="separator:a661899bca5e0528022c981c5e967abad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc1866d0fd86e2f68f6d9393f65efc78"><td class="memItemLeft" align="right" valign="top"><a id="adc1866d0fd86e2f68f6d9393f65efc78"></a>
<a class="el" href="classIoCore.html">IoCore</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#adc1866d0fd86e2f68f6d9393f65efc78">operator=</a> (const <a class="el" href="classIoCore.html">IoCore</a> &amp;)=delete</td></tr>
<tr class="memdesc:adc1866d0fd86e2f68f6d9393f65efc78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deleted copy-assignment. <br /></td></tr>
<tr class="separator:adc1866d0fd86e2f68f6d9393f65efc78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7691456b297fac223169ff929530c548"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a7691456b297fac223169ff929530c548">Run</a> (const std::string &amp;host, const std::string &amp;port)</td></tr>
<tr class="memdesc:a7691456b297fac223169ff929530c548"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the reactor.  <a href="#a7691456b297fac223169ff929530c548">More...</a><br /></td></tr>
<tr class="separator:a7691456b297fac223169ff929530c548"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0fb1ceaddf3afc93029a051b21c8f11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#ab0fb1ceaddf3afc93029a051b21c8f11">Accept</a> (uv_stream_t *<a class="el" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a>)</td></tr>
<tr class="memdesc:ab0fb1ceaddf3afc93029a051b21c8f11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepts a new connection.  <a href="#ab0fb1ceaddf3afc93029a051b21c8f11">More...</a><br /></td></tr>
<tr class="separator:ab0fb1ceaddf3afc93029a051b21c8f11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99d15f055ad9c67fb49e9b05c05be572"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a99d15f055ad9c67fb49e9b05c05be572">Remove</a> (size_t id)</td></tr>
<tr class="memdesc:a99d15f055ad9c67fb49e9b05c05be572"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes a connection.  <a href="#a99d15f055ad9c67fb49e9b05c05be572">More...</a><br /></td></tr>
<tr class="separator:a99d15f055ad9c67fb49e9b05c05be572"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ffe03e64cde25b0f85a0b48708f6024"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a1ffe03e64cde25b0f85a0b48708f6024">UpdatePlayer</a> ()</td></tr>
<tr class="memdesc:a1ffe03e64cde25b0f85a0b48708f6024"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a player update cycle.  <a href="#a1ffe03e64cde25b0f85a0b48708f6024">More...</a><br /></td></tr>
<tr class="separator:a1ffe03e64cde25b0f85a0b48708f6024"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a520b28bd5eacf133e094a1129e8661d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a520b28bd5eacf133e094a1129e8661d0">Respond</a> (size_t id, const <a class="el" href="classResponse.html">Response</a> &amp;response) const override</td></tr>
<tr class="memdesc:a520b28bd5eacf133e094a1129e8661d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Outputs a response.  <a href="#a520b28bd5eacf133e094a1129e8661d0">More...</a><br /></td></tr>
<tr class="separator:a520b28bd5eacf133e094a1129e8661d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7896b8a28b0cb6758cd1e3064485860f"><td class="memItemLeft" align="right" valign="top"><a id="a7896b8a28b0cb6758cd1e3064485860f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a7896b8a28b0cb6758cd1e3064485860f">Shutdown</a> ()</td></tr>
<tr class="memdesc:a7896b8a28b0cb6758cd1e3064485860f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shuts down the <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a> by terminating all IO loop tasks. <br /></td></tr>
<tr class="separator:a7896b8a28b0cb6758cd1e3064485860f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classResponseSink"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classResponseSink')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classResponseSink.html">ResponseSink</a></td></tr>
<tr class="memitem:a561137e7b4a83c636c73c6fcdb7ee305 inherit pub_methods_classResponseSink"><td class="memItemLeft" align="right" valign="top"><a id="a561137e7b4a83c636c73c6fcdb7ee305"></a>
virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classResponseSink.html#a561137e7b4a83c636c73c6fcdb7ee305">~ResponseSink</a> ()=default</td></tr>
<tr class="memdesc:a561137e7b4a83c636c73c6fcdb7ee305 inherit pub_methods_classResponseSink"><td class="mdescLeft">&#160;</td><td class="mdescRight">Empty virtual destructor for <a class="el" href="classResponseSink.html" title="Abstract class for anything that can be sent a response. ">ResponseSink</a>. <br /></td></tr>
<tr class="separator:a561137e7b4a83c636c73c6fcdb7ee305 inherit pub_methods_classResponseSink"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a6c830742ef90306cfdba7a9be7899400"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a6c830742ef90306cfdba7a9be7899400">InitAcceptor</a> (const std::string &amp;address, const std::string &amp;port)</td></tr>
<tr class="memdesc:a6c830742ef90306cfdba7a9be7899400"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialises a TCP acceptor on the given address and port.  <a href="#a6c830742ef90306cfdba7a9be7899400">More...</a><br /></td></tr>
<tr class="separator:a6c830742ef90306cfdba7a9be7899400"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51fc6a9ab76b2bdaea592ff1d4cfcdac"><td class="memItemLeft" align="right" valign="top"><a id="a51fc6a9ab76b2bdaea592ff1d4cfcdac"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a51fc6a9ab76b2bdaea592ff1d4cfcdac">InitUpdateTimer</a> ()</td></tr>
<tr class="memdesc:a51fc6a9ab76b2bdaea592ff1d4cfcdac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up a periodic timer to run the playd update loop. <br /></td></tr>
<tr class="separator:a51fc6a9ab76b2bdaea592ff1d4cfcdac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6274cd606f1213e405e6a422f27413e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a6274cd606f1213e405e6a422f27413e0">InitSignals</a> ()</td></tr>
<tr class="memdesc:a6274cd606f1213e405e6a422f27413e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialises playd's signal handling.  <a href="#a6274cd606f1213e405e6a422f27413e0">More...</a><br /></td></tr>
<tr class="separator:a6274cd606f1213e405e6a422f27413e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a837f4e1b09a7337e7e607a7dd2ba39fc"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a837f4e1b09a7337e7e607a7dd2ba39fc">NextConnectionID</a> ()</td></tr>
<tr class="memdesc:a837f4e1b09a7337e7e607a7dd2ba39fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquires the next available connection ID.  <a href="#a837f4e1b09a7337e7e607a7dd2ba39fc">More...</a><br /></td></tr>
<tr class="separator:a837f4e1b09a7337e7e607a7dd2ba39fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c2e947ef5789b72c8b14f9fc1f02fa7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a1c2e947ef5789b72c8b14f9fc1f02fa7">ExpandPool</a> ()</td></tr>
<tr class="memdesc:a1c2e947ef5789b72c8b14f9fc1f02fa7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a new connection slot to the connection pool.  <a href="#a1c2e947ef5789b72c8b14f9fc1f02fa7">More...</a><br /></td></tr>
<tr class="separator:a1c2e947ef5789b72c8b14f9fc1f02fa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52cc9d45900b5ada51abd71d29a37502"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a52cc9d45900b5ada51abd71d29a37502">Broadcast</a> (const <a class="el" href="classResponse.html">Response</a> &amp;response) const</td></tr>
<tr class="memdesc:a52cc9d45900b5ada51abd71d29a37502"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the given response to all connections.  <a href="#a52cc9d45900b5ada51abd71d29a37502">More...</a><br /></td></tr>
<tr class="separator:a52cc9d45900b5ada51abd71d29a37502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f3728ba1217431a57326641922eeb04"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a7f3728ba1217431a57326641922eeb04">Unicast</a> (size_t id, const <a class="el" href="classResponse.html">Response</a> &amp;response) const</td></tr>
<tr class="memdesc:a7f3728ba1217431a57326641922eeb04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the given response to the identified connection.  <a href="#a7f3728ba1217431a57326641922eeb04">More...</a><br /></td></tr>
<tr class="separator:a7f3728ba1217431a57326641922eeb04"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:aca09f696d0ca9583be54802a954020bb"><td class="memItemLeft" align="right" valign="top"><a id="aca09f696d0ca9583be54802a954020bb"></a>
uv_loop_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a></td></tr>
<tr class="memdesc:aca09f696d0ca9583be54802a954020bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">The loop this <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a> is using. <br /></td></tr>
<tr class="separator:aca09f696d0ca9583be54802a954020bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af10ff08b7ed5e35ff878a77408ce9dc6"><td class="memItemLeft" align="right" valign="top"><a id="af10ff08b7ed5e35ff878a77408ce9dc6"></a>
uv_signal_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#af10ff08b7ed5e35ff878a77408ce9dc6">sigint</a></td></tr>
<tr class="memdesc:af10ff08b7ed5e35ff878a77408ce9dc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">The libuv handle for the Ctrl-C signal. <br /></td></tr>
<tr class="separator:af10ff08b7ed5e35ff878a77408ce9dc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab18dd7e6bbe2a856717e17dd96b14427"><td class="memItemLeft" align="right" valign="top"><a id="ab18dd7e6bbe2a856717e17dd96b14427"></a>
uv_tcp_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a></td></tr>
<tr class="memdesc:ab18dd7e6bbe2a856717e17dd96b14427"><td class="mdescLeft">&#160;</td><td class="mdescRight">The libuv handle for the TCP server. <br /></td></tr>
<tr class="separator:ab18dd7e6bbe2a856717e17dd96b14427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2930e9bbf773534ed07ef46248b9e512"><td class="memItemLeft" align="right" valign="top"><a id="a2930e9bbf773534ed07ef46248b9e512"></a>
uv_timer_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a2930e9bbf773534ed07ef46248b9e512">updater</a></td></tr>
<tr class="memdesc:a2930e9bbf773534ed07ef46248b9e512"><td class="mdescLeft">&#160;</td><td class="mdescRight">The libuv handle for the update timer. <br /></td></tr>
<tr class="separator:a2930e9bbf773534ed07ef46248b9e512"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5d296ab190bb4f39e1f8195c464c68a"><td class="memItemLeft" align="right" valign="top"><a id="af5d296ab190bb4f39e1f8195c464c68a"></a>
<a class="el" href="classPlayer.html">Player</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">player</a></td></tr>
<tr class="memdesc:af5d296ab190bb4f39e1f8195c464c68a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The player. <br /></td></tr>
<tr class="separator:af5d296ab190bb4f39e1f8195c464c68a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54e99d116bd905271babb7c9e21d35d8"><td class="memItemLeft" align="right" valign="top"><a id="a54e99d116bd905271babb7c9e21d35d8"></a>
std::vector&lt; std::shared_ptr&lt; <a class="el" href="classConnection.html">Connection</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a></td></tr>
<tr class="memdesc:a54e99d116bd905271babb7c9e21d35d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">The set of connections inside this <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a>. <br /></td></tr>
<tr class="separator:a54e99d116bd905271babb7c9e21d35d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50119d91a07d6e7a9380226197e83424"><td class="memItemLeft" align="right" valign="top">std::vector&lt; size_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">free_list</a></td></tr>
<tr class="memdesc:a50119d91a07d6e7a9380226197e83424"><td class="mdescLeft">&#160;</td><td class="mdescRight">A list of free 1-indexed slots inside pool.  <a href="#a50119d91a07d6e7a9380226197e83424">More...</a><br /></td></tr>
<tr class="separator:a50119d91a07d6e7a9380226197e83424"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:aef9ab85a98d83e54bbb4e25b81d6c625"><td class="memItemLeft" align="right" valign="top"><a id="aef9ab85a98d83e54bbb4e25b81d6c625"></a>
static const uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIoCore.html#aef9ab85a98d83e54bbb4e25b81d6c625">PLAYER_UPDATE_PERIOD</a> = 5</td></tr>
<tr class="memdesc:aef9ab85a98d83e54bbb4e25b81d6c625"><td class="mdescLeft">&#160;</td><td class="mdescRight">The period between player updates. <br /></td></tr>
<tr class="separator:aef9ab85a98d83e54bbb4e25b81d6c625"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The IO core, which services input, routes responses, and executes the <a class="el" href="classPlayer.html" title="A Player contains a loaded audio file and a command API for manipulating it. ">Player</a> update routine periodically. </p>
<p>The IO core also maintains a pool of connections which can be sent responses via their IDs inside the pool. It ensures that each connection is given an ID that is unique up until the removal of said connection. </p>

<p>Definition at line <a class="el" href="io_8hpp_source.html#l00039">39</a> of file <a class="el" href="io_8hpp_source.html">io.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7d61a2bcec6a72a8aa0496964bc821a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d61a2bcec6a72a8aa0496964bc821a3">&sect;&nbsp;</a></span>IoCore()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">IoCore::IoCore </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPlayer.html">Player</a> &amp;&#160;</td>
          <td class="paramname"><em>player</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructs an <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">player</td><td>The player to which update requests, commands, and new connection state dump requests shall be sent. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00170">170</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                             : <a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a>(<span class="keyword">nullptr</span>), <a class="code" href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">player</a>(player)</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;{</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div><div class="ttc" id="classIoCore_html_af5d296ab190bb4f39e1f8195c464c68a"><div class="ttname"><a href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">IoCore::player</a></div><div class="ttdeci">Player &amp; player</div><div class="ttdoc">The player. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00111">io.hpp:111</a></div></div>
<div class="ttc" id="classIoCore_html_aca09f696d0ca9583be54802a954020bb"><div class="ttname"><a href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">IoCore::loop</a></div><div class="ttdeci">uv_loop_t * loop</div><div class="ttdoc">The loop this IoCore is using. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00106">io.hpp:106</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab0fb1ceaddf3afc93029a051b21c8f11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0fb1ceaddf3afc93029a051b21c8f11">&sect;&nbsp;</a></span>Accept()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::Accept </td>
          <td>(</td>
          <td class="paramtype">uv_stream_t *&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accepts a new connection. </p>
<p>This accepts the connection, and adds it to this <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a>'s connection pool.</p>
<p>This should be called with a server that has just received a new connection.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>Pointer to the libuv server accepting connections. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00190">190</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="classResponse.html#a1b05bb2ef6f51684611b25eee75f4f99a84c0f9eb2365e5810c917acd77fd0060">Response::IAMA</a>, <a class="el" href="io_8hpp_source.html#l00106">loop</a>, <a class="el" href="messages_8h_source.html#l00025">MSG_OHAI_BIFROST</a>, <a class="el" href="messages_8h_source.html#l00022">MSG_OHAI_PLAYD</a>, <a class="el" href="io_8cpp_source.html#l00223">NextConnectionID()</a>, <a class="el" href="response_8hpp_source.html#l00027">Response::NOREQUEST</a>, <a class="el" href="classResponse.html#a1b05bb2ef6f51684611b25eee75f4f99a578a88371503e8fd23725bd3a684ed9e">Response::OHAI</a>, <a class="el" href="io_8hpp_source.html#l00111">player</a>, <a class="el" href="io_8hpp_source.html#l00114">pool</a>, <a class="el" href="io_8cpp_source.html#l00305">Respond()</a>, <a class="el" href="response_8cpp_source.html#l00049">Response::Success()</a>, <a class="el" href="io_8cpp_source.html#l00051">UvAlloc()</a>, <a class="el" href="io_8cpp_source.html#l00058">UvCloseCallback()</a>, and <a class="el" href="io_8cpp_source.html#l00065">UvReadCallback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    assert(<a class="code" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a> != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    assert(this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a> != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keyword">auto</span> client = <span class="keyword">new</span> uv_tcp_t();</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    uv_tcp_init(this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a>, client);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// libuv does the &#39;nonzero is error&#39; thing here</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (uv_accept(<a class="code" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a>, (uv_stream_t *)client)) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        uv_close((uv_handle_t *)client, <a class="code" href="io_8cpp.html#ab85791c3e9c737453047decfbb7388f4">UvCloseCallback</a>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keyword">auto</span> <span class="keywordtype">id</span> = this-&gt;<a class="code" href="classIoCore.html#a837f4e1b09a7337e7e607a7dd2ba39fc">NextConnectionID</a>();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">auto</span> conn = std::make_shared&lt;Connection&gt;(*<span class="keyword">this</span>, client, this-&gt;<a class="code" href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">player</a>, id);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    client-&gt;data = <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(conn.get());</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>[<span class="keywordtype">id</span> - 1] = std::move(conn);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// Begin initial responses</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a520b28bd5eacf133e094a1129e8661d0">Respond</a>(<span class="keywordtype">id</span>, <a class="code" href="classResponse.html">Response</a>(<a class="code" href="classResponse.html#a58878593dc8d9b704a07815cb55a9635">Response::NOREQUEST</a>, <a class="code" href="classResponse.html#a1b05bb2ef6f51684611b25eee75f4f99a578a88371503e8fd23725bd3a684ed9e">Response::Code::OHAI</a>)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                              .AddArg(std::to_string(<span class="keywordtype">id</span>))</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                              .AddArg(<a class="code" href="messages_8h.html#ac926f8f42d4160102cf9b65529359a5e">MSG_OHAI_BIFROST</a>)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                              .AddArg(<a class="code" href="messages_8h.html#acdc0d433eab9aaa20a9a71fe86748ef8">MSG_OHAI_PLAYD</a>));</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a520b28bd5eacf133e094a1129e8661d0">Respond</a>(<span class="keywordtype">id</span>, <a class="code" href="classResponse.html">Response</a>(<a class="code" href="classResponse.html#a58878593dc8d9b704a07815cb55a9635">Response::NOREQUEST</a>, <a class="code" href="classResponse.html#a1b05bb2ef6f51684611b25eee75f4f99a84c0f9eb2365e5810c917acd77fd0060">Response::Code::IAMA</a>)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                              .AddArg(<span class="stringliteral">&quot;player/file&quot;</span>));</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    this-&gt;player.Dump(<span class="keywordtype">id</span>, <a class="code" href="classResponse.html#a58878593dc8d9b704a07815cb55a9635">Response::NOREQUEST</a>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a520b28bd5eacf133e094a1129e8661d0">Respond</a>(<span class="keywordtype">id</span>, <a class="code" href="classResponse.html#a9ed9bafaa602212d0d71a5d4e5c624ea">Response::Success</a>(<a class="code" href="classResponse.html#a58878593dc8d9b704a07815cb55a9635">Response::NOREQUEST</a>));</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// End initial responses</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    uv_read_start((uv_stream_t *)client, <a class="code" href="io_8cpp.html#ab0c51a1d8447db72e81a13d45448b85f">UvAlloc</a>, <a class="code" href="io_8cpp.html#a8c1937e7aebd228e6a5eab19f1add9f9">UvReadCallback</a>);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;}</div><div class="ttc" id="classIoCore_html_a837f4e1b09a7337e7e607a7dd2ba39fc"><div class="ttname"><a href="classIoCore.html#a837f4e1b09a7337e7e607a7dd2ba39fc">IoCore::NextConnectionID</a></div><div class="ttdeci">size_t NextConnectionID()</div><div class="ttdoc">Acquires the next available connection ID. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00223">io.cpp:223</a></div></div>
<div class="ttc" id="classResponse_html"><div class="ttname"><a href="classResponse.html">Response</a></div><div class="ttdoc">A response. </div><div class="ttdef"><b>Definition:</b> <a href="response_8hpp_source.html#l00023">response.hpp:23</a></div></div>
<div class="ttc" id="io_8cpp_html_ab0c51a1d8447db72e81a13d45448b85f"><div class="ttname"><a href="io_8cpp.html#ab0c51a1d8447db72e81a13d45448b85f">UvAlloc</a></div><div class="ttdeci">void UvAlloc(uv_handle_t *, size_t suggested_size, uv_buf_t *buf)</div><div class="ttdoc">The function used to allocate and initialise buffers for client reading. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00051">io.cpp:51</a></div></div>
<div class="ttc" id="classResponse_html_a58878593dc8d9b704a07815cb55a9635"><div class="ttname"><a href="classResponse.html#a58878593dc8d9b704a07815cb55a9635">Response::NOREQUEST</a></div><div class="ttdeci">static const std::string NOREQUEST</div><div class="ttdoc">The tag for unsolicited messages (not from responses). </div><div class="ttdef"><b>Definition:</b> <a href="response_8hpp_source.html#l00027">response.hpp:27</a></div></div>
<div class="ttc" id="classResponse_html_a9ed9bafaa602212d0d71a5d4e5c624ea"><div class="ttname"><a href="classResponse.html#a9ed9bafaa602212d0d71a5d4e5c624ea">Response::Success</a></div><div class="ttdeci">static Response Success(const std::string &amp;tag)</div><div class="ttdoc">Shortcut for constructing a final response to a successful request. </div><div class="ttdef"><b>Definition:</b> <a href="response_8cpp_source.html#l00049">response.cpp:49</a></div></div>
<div class="ttc" id="classIoCore_html_af5d296ab190bb4f39e1f8195c464c68a"><div class="ttname"><a href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">IoCore::player</a></div><div class="ttdeci">Player &amp; player</div><div class="ttdoc">The player. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00111">io.hpp:111</a></div></div>
<div class="ttc" id="classIoCore_html_a520b28bd5eacf133e094a1129e8661d0"><div class="ttname"><a href="classIoCore.html#a520b28bd5eacf133e094a1129e8661d0">IoCore::Respond</a></div><div class="ttdeci">void Respond(size_t id, const Response &amp;response) const override</div><div class="ttdoc">Outputs a response. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00305">io.cpp:305</a></div></div>
<div class="ttc" id="io_8cpp_html_a8c1937e7aebd228e6a5eab19f1add9f9"><div class="ttname"><a href="io_8cpp.html#a8c1937e7aebd228e6a5eab19f1add9f9">UvReadCallback</a></div><div class="ttdeci">void UvReadCallback(uv_stream_t *stream, ssize_t nread, const uv_buf_t *buf)</div><div class="ttdoc">The callback fired when some bytes are read from a client connection. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00065">io.cpp:65</a></div></div>
<div class="ttc" id="classIoCore_html_ab18dd7e6bbe2a856717e17dd96b14427"><div class="ttname"><a href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">IoCore::server</a></div><div class="ttdeci">uv_tcp_t server</div><div class="ttdoc">The libuv handle for the TCP server. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00108">io.hpp:108</a></div></div>
<div class="ttc" id="io_8cpp_html_ab85791c3e9c737453047decfbb7388f4"><div class="ttname"><a href="io_8cpp.html#ab85791c3e9c737453047decfbb7388f4">UvCloseCallback</a></div><div class="ttdeci">void UvCloseCallback(uv_handle_t *handle)</div><div class="ttdoc">The callback fired when a client connection closes. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00058">io.cpp:58</a></div></div>
<div class="ttc" id="classIoCore_html_a54e99d116bd905271babb7c9e21d35d8"><div class="ttname"><a href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">IoCore::pool</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; Connection &gt; &gt; pool</div><div class="ttdoc">The set of connections inside this IoCore. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00114">io.hpp:114</a></div></div>
<div class="ttc" id="messages_8h_html_ac926f8f42d4160102cf9b65529359a5e"><div class="ttname"><a href="messages_8h.html#ac926f8f42d4160102cf9b65529359a5e">MSG_OHAI_BIFROST</a></div><div class="ttdeci">const std::string MSG_OHAI_BIFROST</div><div class="ttdoc">The protocol name and version. </div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00025">messages.h:25</a></div></div>
<div class="ttc" id="classResponse_html_a1b05bb2ef6f51684611b25eee75f4f99a84c0f9eb2365e5810c917acd77fd0060"><div class="ttname"><a href="classResponse.html#a1b05bb2ef6f51684611b25eee75f4f99a84c0f9eb2365e5810c917acd77fd0060">Response::Code::IAMA</a></div><div class="ttdoc">Server sending its role. </div></div>
<div class="ttc" id="classIoCore_html_aca09f696d0ca9583be54802a954020bb"><div class="ttname"><a href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">IoCore::loop</a></div><div class="ttdeci">uv_loop_t * loop</div><div class="ttdoc">The loop this IoCore is using. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00106">io.hpp:106</a></div></div>
<div class="ttc" id="classResponse_html_a1b05bb2ef6f51684611b25eee75f4f99a578a88371503e8fd23725bd3a684ed9e"><div class="ttname"><a href="classResponse.html#a1b05bb2ef6f51684611b25eee75f4f99a578a88371503e8fd23725bd3a684ed9e">Response::Code::OHAI</a></div><div class="ttdoc">Server starting up. </div></div>
<div class="ttc" id="messages_8h_html_acdc0d433eab9aaa20a9a71fe86748ef8"><div class="ttname"><a href="messages_8h.html#acdc0d433eab9aaa20a9a71fe86748ef8">MSG_OHAI_PLAYD</a></div><div class="ttdeci">const std::string MSG_OHAI_PLAYD</div><div class="ttdoc">The playd name and version. </div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00022">messages.h:22</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a52cc9d45900b5ada51abd71d29a37502"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52cc9d45900b5ada51abd71d29a37502">&sect;&nbsp;</a></span>Broadcast()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::Broadcast </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classResponse.html">Response</a> &amp;&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends the given response to all connections. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">response</td><td>The response to broadcast. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00316">316</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="response_8cpp_source.html#l00044">Response::Pack()</a>, and <a class="el" href="io_8hpp_source.html#l00114">pool</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00305">Respond()</a>.</p>
<div class="fragment"><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;{</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="classDebug.html">Debug</a>() &lt;&lt; <span class="stringliteral">&quot;broadcast:&quot;</span> &lt;&lt; response.<a class="code" href="classResponse.html#a38600396348b60b90720bb92a058d9b3">Pack</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// Copy the connection by value, so that there&#39;s at least one</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// active reference to it throughout.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> c : this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span> (c) c-&gt;Respond(response);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="ttc" id="classResponse_html_a38600396348b60b90720bb92a058d9b3"><div class="ttname"><a href="classResponse.html#a38600396348b60b90720bb92a058d9b3">Response::Pack</a></div><div class="ttdeci">std::string Pack() const</div><div class="ttdoc">Packs the Response, converting it to a BAPS3 protocol message. </div><div class="ttdef"><b>Definition:</b> <a href="response_8cpp_source.html#l00044">response.cpp:44</a></div></div>
<div class="ttc" id="classIoCore_html_a54e99d116bd905271babb7c9e21d35d8"><div class="ttname"><a href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">IoCore::pool</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; Connection &gt; &gt; pool</div><div class="ttdoc">The set of connections inside this IoCore. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00114">io.hpp:114</a></div></div>
<div class="ttc" id="classDebug_html"><div class="ttname"><a href="classDebug.html">Debug</a></div><div class="ttdoc">Class for telling the human what playd is doing. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00133">errors.hpp:133</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1c2e947ef5789b72c8b14f9fc1f02fa7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c2e947ef5789b72c8b14f9fc1f02fa7">&sect;&nbsp;</a></span>ExpandPool()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::ExpandPool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds a new connection slot to the connection pool. </p>
<p>This is called by NextConnectionID when the number of currently running connections is larger than the number of existing pool slots, and will eventually fail (when the number of simultaneous connections reaches absurd proportions). </p>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00243">243</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8hpp_source.html#l00118">free_list</a>, <a class="el" href="messages_8h_source.html#l00121">MSG_TOO_MANY_CONNS</a>, and <a class="el" href="io_8hpp_source.html#l00114">pool</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00223">NextConnectionID()</a>.</p>
<div class="fragment"><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;{</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// If we already have SIZE_MAX-1 simultaneous connections, we bail out.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// Since this is at least 65,534, and likely to be 2^32-2 or 2^64-2,</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// this is incredibly unlikely to happen and probably means someone&#39;s</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// trying to denial-of-service an audio player.</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// Why -1?  Because slot 0 in the connection pool is reserved for</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// broadcasts.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordtype">bool</span> full = this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.size() == (SIZE_MAX - 1);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (full) <span class="keywordflow">throw</span> <a class="code" href="classInternalError.html">InternalError</a>(<a class="code" href="messages_8h.html#a5b4d85fda3051448fc7bc0853ca793f4">MSG_TOO_MANY_CONNS</a>);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.emplace_back(<span class="keyword">nullptr</span>);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// This isn&#39;t an off-by-one error; slots index from 1.</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">free_list</a>.push_back(this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.size());</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div><div class="ttc" id="classIoCore_html_a50119d91a07d6e7a9380226197e83424"><div class="ttname"><a href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">IoCore::free_list</a></div><div class="ttdeci">std::vector&lt; size_t &gt; free_list</div><div class="ttdoc">A list of free 1-indexed slots inside pool. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00118">io.hpp:118</a></div></div>
<div class="ttc" id="messages_8h_html_a5b4d85fda3051448fc7bc0853ca793f4"><div class="ttname"><a href="messages_8h.html#a5b4d85fda3051448fc7bc0853ca793f4">MSG_TOO_MANY_CONNS</a></div><div class="ttdeci">const std::string MSG_TOO_MANY_CONNS</div><div class="ttdoc">Message shown when too many simultaneous connections are launched. </div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00121">messages.h:121</a></div></div>
<div class="ttc" id="classIoCore_html_a54e99d116bd905271babb7c9e21d35d8"><div class="ttname"><a href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">IoCore::pool</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; Connection &gt; &gt; pool</div><div class="ttdoc">The set of connections inside this IoCore. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00114">io.hpp:114</a></div></div>
<div class="ttc" id="classInternalError_html"><div class="ttname"><a href="classInternalError.html">InternalError</a></div><div class="ttdoc">An Error signifying that playd has hit an internal snag. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00060">errors.hpp:60</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6c830742ef90306cfdba7a9be7899400"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c830742ef90306cfdba7a9be7899400">&sect;&nbsp;</a></span>InitAcceptor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::InitAcceptor </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialises a TCP acceptor on the given address and port. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The IPv4 address on which the TCP server should listen. </td></tr>
    <tr><td class="paramname">port</td><td>The TCP port on which the TCP server should listen. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00349">349</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8hpp_source.html#l00106">loop</a>, <a class="el" href="messages_8h_source.html#l00118">MSG_IO_CANNOT_ALLOC</a>, <a class="el" href="io_8hpp_source.html#l00108">server</a>, and <a class="el" href="io_8cpp_source.html#l00080">UvListenCallback()</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00174">Run()</a>.</p>
<div class="fragment"><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;{</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    assert(this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a> != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> (uv_tcp_init(this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a>, &amp;this-&gt;<a class="code" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a>)) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="classInternalError.html">InternalError</a>(<a class="code" href="messages_8h.html#aca0c9703b6abb116e21512d53e1b35c3">MSG_IO_CANNOT_ALLOC</a>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a>.data = <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(<span class="keyword">this</span>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    assert(this-&gt;<a class="code" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a>.data != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keyword">struct </span>sockaddr_in bind_addr;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    uv_ip4_addr(address.c_str(), std::stoi(port), &amp;bind_addr);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    uv_tcp_bind(&amp;this-&gt;<a class="code" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a>, (<span class="keyword">const</span> sockaddr *)&amp;bind_addr, 0);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordtype">int</span> r = uv_listen((uv_stream_t *)&amp;this-&gt;<a class="code" href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">server</a>, 128, <a class="code" href="io_8cpp.html#ab1a411534cf6420d24748b0e78927ebf">UvListenCallback</a>);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (r) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="classNetError.html">NetError</a>(<span class="stringliteral">&quot;Could not listen on &quot;</span> + address + <span class="stringliteral">&quot;:&quot;</span> + port +</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                       <span class="stringliteral">&quot; (&quot;</span> + std::string(uv_err_name(r)) + <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="classDebug.html">Debug</a>() &lt;&lt; <span class="stringliteral">&quot;Listening at&quot;</span> &lt;&lt; address &lt;&lt; <span class="stringliteral">&quot;on&quot;</span> &lt;&lt; port &lt;&lt; std::endl;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div><div class="ttc" id="messages_8h_html_aca0c9703b6abb116e21512d53e1b35c3"><div class="ttname"><a href="messages_8h.html#aca0c9703b6abb116e21512d53e1b35c3">MSG_IO_CANNOT_ALLOC</a></div><div class="ttdeci">const std::string MSG_IO_CANNOT_ALLOC</div><div class="ttdoc">Message shown when allocating an IO object fails. </div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00118">messages.h:118</a></div></div>
<div class="ttc" id="io_8cpp_html_ab1a411534cf6420d24748b0e78927ebf"><div class="ttname"><a href="io_8cpp.html#ab1a411534cf6420d24748b0e78927ebf">UvListenCallback</a></div><div class="ttdeci">void UvListenCallback(uv_stream_t *server, int status)</div><div class="ttdoc">The callback fired when a new client connection is acquired by the listener. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00080">io.cpp:80</a></div></div>
<div class="ttc" id="classIoCore_html_ab18dd7e6bbe2a856717e17dd96b14427"><div class="ttname"><a href="classIoCore.html#ab18dd7e6bbe2a856717e17dd96b14427">IoCore::server</a></div><div class="ttdeci">uv_tcp_t server</div><div class="ttdoc">The libuv handle for the TCP server. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00108">io.hpp:108</a></div></div>
<div class="ttc" id="classNetError_html"><div class="ttname"><a href="classNetError.html">NetError</a></div><div class="ttdoc">A network error. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00105">errors.hpp:105</a></div></div>
<div class="ttc" id="classDebug_html"><div class="ttname"><a href="classDebug.html">Debug</a></div><div class="ttdoc">Class for telling the human what playd is doing. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00133">errors.hpp:133</a></div></div>
<div class="ttc" id="classInternalError_html"><div class="ttname"><a href="classInternalError.html">InternalError</a></div><div class="ttdoc">An Error signifying that playd has hit an internal snag. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00060">errors.hpp:60</a></div></div>
<div class="ttc" id="classIoCore_html_aca09f696d0ca9583be54802a954020bb"><div class="ttname"><a href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">IoCore::loop</a></div><div class="ttdeci">uv_loop_t * loop</div><div class="ttdoc">The loop this IoCore is using. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00106">io.hpp:106</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6274cd606f1213e405e6a422f27413e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6274cd606f1213e405e6a422f27413e0">&sect;&nbsp;</a></span>InitSignals()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::InitSignals </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialises playd's signal handling. </p>
<p>We trap SIGINT, and the equivalent emulated signal on Windows, to make playd close gracefully when Ctrl-C is sent. </p>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00372">372</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8hpp_source.html#l00106">loop</a>, <a class="el" href="messages_8h_source.html#l00118">MSG_IO_CANNOT_ALLOC</a>, <a class="el" href="io_8hpp_source.html#l00111">player</a>, <a class="el" href="io_8hpp_source.html#l00107">sigint</a>, and <a class="el" href="io_8cpp_source.html#l00129">UvSigintCallback()</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00174">Run()</a>.</p>
<div class="fragment"><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;{</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordtype">int</span> r = uv_signal_init(this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a>, &amp;this-&gt;<a class="code" href="classIoCore.html#af10ff08b7ed5e35ff878a77408ce9dc6">sigint</a>);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (r) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="classInternalError.html">InternalError</a>(<a class="code" href="messages_8h.html#aca0c9703b6abb116e21512d53e1b35c3">MSG_IO_CANNOT_ALLOC</a> + <span class="stringliteral">&quot;: &quot;</span> +</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                            std::string(uv_err_name(r)));</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// We pass the player, not the IoCore.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// This is so the SIGINT handler can tell the player to quit,</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// which then tells us to shutdown</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#af10ff08b7ed5e35ff878a77408ce9dc6">sigint</a>.data = <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(&amp;this-&gt;<a class="code" href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">player</a>);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    assert(this-&gt;<a class="code" href="classIoCore.html#af10ff08b7ed5e35ff878a77408ce9dc6">sigint</a>.data != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    uv_signal_start(&amp;this-&gt;<a class="code" href="classIoCore.html#af10ff08b7ed5e35ff878a77408ce9dc6">sigint</a>, <a class="code" href="io_8cpp.html#a830b8f3b5c6a0d4d4c8c15b4cfbfd47c">UvSigintCallback</a>, SIGINT);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div><div class="ttc" id="messages_8h_html_aca0c9703b6abb116e21512d53e1b35c3"><div class="ttname"><a href="messages_8h.html#aca0c9703b6abb116e21512d53e1b35c3">MSG_IO_CANNOT_ALLOC</a></div><div class="ttdeci">const std::string MSG_IO_CANNOT_ALLOC</div><div class="ttdoc">Message shown when allocating an IO object fails. </div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00118">messages.h:118</a></div></div>
<div class="ttc" id="io_8cpp_html_a830b8f3b5c6a0d4d4c8c15b4cfbfd47c"><div class="ttname"><a href="io_8cpp.html#a830b8f3b5c6a0d4d4c8c15b4cfbfd47c">UvSigintCallback</a></div><div class="ttdeci">void UvSigintCallback(uv_signal_t *handle, int signum)</div><div class="ttdoc">The callback fired when SIGINT occurs. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00129">io.cpp:129</a></div></div>
<div class="ttc" id="classIoCore_html_af10ff08b7ed5e35ff878a77408ce9dc6"><div class="ttname"><a href="classIoCore.html#af10ff08b7ed5e35ff878a77408ce9dc6">IoCore::sigint</a></div><div class="ttdeci">uv_signal_t sigint</div><div class="ttdoc">The libuv handle for the Ctrl-C signal. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00107">io.hpp:107</a></div></div>
<div class="ttc" id="classIoCore_html_af5d296ab190bb4f39e1f8195c464c68a"><div class="ttname"><a href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">IoCore::player</a></div><div class="ttdeci">Player &amp; player</div><div class="ttdoc">The player. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00111">io.hpp:111</a></div></div>
<div class="ttc" id="classInternalError_html"><div class="ttname"><a href="classInternalError.html">InternalError</a></div><div class="ttdoc">An Error signifying that playd has hit an internal snag. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00060">errors.hpp:60</a></div></div>
<div class="ttc" id="classIoCore_html_aca09f696d0ca9583be54802a954020bb"><div class="ttname"><a href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">IoCore::loop</a></div><div class="ttdeci">uv_loop_t * loop</div><div class="ttdoc">The loop this IoCore is using. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00106">io.hpp:106</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a837f4e1b09a7337e7e607a7dd2ba39fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a837f4e1b09a7337e7e607a7dd2ba39fc">&sect;&nbsp;</a></span>NextConnectionID()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t IoCore::NextConnectionID </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Acquires the next available connection ID. </p>
<p>This ID may have been assigned to a connection in the past, but is guaranteed not to match any currently assigned IDs. </p><dl class="section return"><dt>Returns</dt><dd>size_t A fresh ID for use. </dd></dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00223">223</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8cpp_source.html#l00243">ExpandPool()</a>, <a class="el" href="io_8hpp_source.html#l00118">free_list</a>, and <a class="el" href="io_8hpp_source.html#l00114">pool</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00190">Accept()</a>.</p>
<div class="fragment"><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// We&#39;ll want to try and use an existing, empty ID in the connection</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// pool.  If there aren&#39;t any (we&#39;ve exceeded the maximum-so-far number</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// of simultaneous connections), we expand the pool.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">free_list</a>.empty()) this-&gt;<a class="code" href="classIoCore.html#a1c2e947ef5789b72c8b14f9fc1f02fa7">ExpandPool</a>();</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    assert(!this-&gt;<a class="code" href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">free_list</a>.empty());</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// Acquire some free ID, and ensure that the ID cannot be re-used until</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// replaced onto the free list by the connection&#39;s removal.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = this-&gt;<a class="code" href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">free_list</a>.back();</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">free_list</a>.pop_back();</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// client_slot should be at least 1, because of the above.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    assert(0 &lt; <span class="keywordtype">id</span>);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    assert(id &lt;= this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.size());</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> id;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div><div class="ttc" id="classIoCore_html_a50119d91a07d6e7a9380226197e83424"><div class="ttname"><a href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">IoCore::free_list</a></div><div class="ttdeci">std::vector&lt; size_t &gt; free_list</div><div class="ttdoc">A list of free 1-indexed slots inside pool. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00118">io.hpp:118</a></div></div>
<div class="ttc" id="classIoCore_html_a54e99d116bd905271babb7c9e21d35d8"><div class="ttname"><a href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">IoCore::pool</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; Connection &gt; &gt; pool</div><div class="ttdoc">The set of connections inside this IoCore. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00114">io.hpp:114</a></div></div>
<div class="ttc" id="classIoCore_html_a1c2e947ef5789b72c8b14f9fc1f02fa7"><div class="ttname"><a href="classIoCore.html#a1c2e947ef5789b72c8b14f9fc1f02fa7">IoCore::ExpandPool</a></div><div class="ttdeci">void ExpandPool()</div><div class="ttdoc">Adds a new connection slot to the connection pool. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00243">io.cpp:243</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a99d15f055ad9c67fb49e9b05c05be572"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99d15f055ad9c67fb49e9b05c05be572">&sect;&nbsp;</a></span>Remove()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::Remove </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes a connection. </p>
<p>As the <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a> owns the <a class="el" href="classConnection.html" title="A TCP connection from a client. ">Connection</a>, it will be destroyed by this operation. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>The ID of the connection to remove. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00260">260</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8hpp_source.html#l00118">free_list</a>, and <a class="el" href="io_8hpp_source.html#l00114">pool</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00535">Connection::Depool()</a>.</p>
<div class="fragment"><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;{</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    assert(0 &lt; slot &amp;&amp; slot &lt;= this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.size());</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// Don&#39;t remove if it&#39;s already a nullptr, because we&#39;d end up with the</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// slot on the free list twice.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.at(slot - 1)) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>[slot - 1] = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        this-&gt;<a class="code" href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">free_list</a>.push_back(slot);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    assert(!this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.at(slot - 1));</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div><div class="ttc" id="classIoCore_html_a50119d91a07d6e7a9380226197e83424"><div class="ttname"><a href="classIoCore.html#a50119d91a07d6e7a9380226197e83424">IoCore::free_list</a></div><div class="ttdeci">std::vector&lt; size_t &gt; free_list</div><div class="ttdoc">A list of free 1-indexed slots inside pool. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00118">io.hpp:118</a></div></div>
<div class="ttc" id="classIoCore_html_a54e99d116bd905271babb7c9e21d35d8"><div class="ttname"><a href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">IoCore::pool</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; Connection &gt; &gt; pool</div><div class="ttdoc">The set of connections inside this IoCore. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00114">io.hpp:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a520b28bd5eacf133e094a1129e8661d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a520b28bd5eacf133e094a1129e8661d0">&sect;&nbsp;</a></span>Respond()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::Respond </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classResponse.html">Response</a> &amp;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Outputs a response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>The ID of the client of the <a class="el" href="classResponseSink.html" title="Abstract class for anything that can be sent a response. ">ResponseSink</a> receiving this response. Use 0 for broadcasts. </td></tr>
    <tr><td class="paramname">response</td><td>The <a class="el" href="classResponse.html" title="A response. ">Response</a> to output. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classResponseSink.html#aa807ac9782724ad1497b5523efac956a">ResponseSink</a>.</p>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00305">305</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8cpp_source.html#l00316">Broadcast()</a>, <a class="el" href="io_8hpp_source.html#l00114">pool</a>, and <a class="el" href="io_8cpp_source.html#l00327">Unicast()</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00190">Accept()</a>.</p>
<div class="fragment"><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;{</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.empty()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 0) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        this-&gt;<a class="code" href="classIoCore.html#a52cc9d45900b5ada51abd71d29a37502">Broadcast</a>(response);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        this-&gt;<a class="code" href="classIoCore.html#a7f3728ba1217431a57326641922eeb04">Unicast</a>(<span class="keywordtype">id</span>, response);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div><div class="ttc" id="classIoCore_html_a52cc9d45900b5ada51abd71d29a37502"><div class="ttname"><a href="classIoCore.html#a52cc9d45900b5ada51abd71d29a37502">IoCore::Broadcast</a></div><div class="ttdeci">void Broadcast(const Response &amp;response) const</div><div class="ttdoc">Sends the given response to all connections. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00316">io.cpp:316</a></div></div>
<div class="ttc" id="classIoCore_html_a7f3728ba1217431a57326641922eeb04"><div class="ttname"><a href="classIoCore.html#a7f3728ba1217431a57326641922eeb04">IoCore::Unicast</a></div><div class="ttdeci">void Unicast(size_t id, const Response &amp;response) const</div><div class="ttdoc">Sends the given response to the identified connection. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00327">io.cpp:327</a></div></div>
<div class="ttc" id="classIoCore_html_a54e99d116bd905271babb7c9e21d35d8"><div class="ttname"><a href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">IoCore::pool</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; Connection &gt; &gt; pool</div><div class="ttdoc">The set of connections inside this IoCore. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00114">io.hpp:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7691456b297fac223169ff929530c548"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7691456b297fac223169ff929530c548">&sect;&nbsp;</a></span>Run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::Run </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Runs the reactor. </p>
<p>It will block until it terminates. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">host</td><td>The IP host to which <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a> will bind. </td></tr>
    <tr><td class="paramname">port</td><td>The TCP port to which <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a> will bind. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classNetError.html" title="A network error. ">NetError</a></td><td>Thrown if <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a> cannot bind to <em>host</em> or <em>port</em>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00174">174</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8cpp_source.html#l00349">InitAcceptor()</a>, <a class="el" href="io_8cpp_source.html#l00372">InitSignals()</a>, <a class="el" href="io_8cpp_source.html#l00338">InitUpdateTimer()</a>, <a class="el" href="io_8hpp_source.html#l00106">loop</a>, and <a class="el" href="messages_8h_source.html#l00118">MSG_IO_CANNOT_ALLOC</a>.</p>

<p>Referenced by <a class="el" href="main_8cpp_source.html#l00150">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a> = uv_default_loop();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a> == <span class="keyword">nullptr</span>) <span class="keywordflow">throw</span> <a class="code" href="classInternalError.html">InternalError</a>(<a class="code" href="messages_8h.html#aca0c9703b6abb116e21512d53e1b35c3">MSG_IO_CANNOT_ALLOC</a>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a6c830742ef90306cfdba7a9be7899400">InitAcceptor</a>(host, port);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a6274cd606f1213e405e6a422f27413e0">InitSignals</a>();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    this-&gt;<a class="code" href="classIoCore.html#a51fc6a9ab76b2bdaea592ff1d4cfcdac">InitUpdateTimer</a>();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    uv_run(this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a>, UV_RUN_DEFAULT);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// We presume all of the open handles have been closed in Shutdown().</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// We need only close the loop.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    uv_loop_close(this-&gt;<a class="code" href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">loop</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="ttc" id="messages_8h_html_aca0c9703b6abb116e21512d53e1b35c3"><div class="ttname"><a href="messages_8h.html#aca0c9703b6abb116e21512d53e1b35c3">MSG_IO_CANNOT_ALLOC</a></div><div class="ttdeci">const std::string MSG_IO_CANNOT_ALLOC</div><div class="ttdoc">Message shown when allocating an IO object fails. </div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00118">messages.h:118</a></div></div>
<div class="ttc" id="classIoCore_html_a6274cd606f1213e405e6a422f27413e0"><div class="ttname"><a href="classIoCore.html#a6274cd606f1213e405e6a422f27413e0">IoCore::InitSignals</a></div><div class="ttdeci">void InitSignals()</div><div class="ttdoc">Initialises playd&amp;#39;s signal handling. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00372">io.cpp:372</a></div></div>
<div class="ttc" id="classIoCore_html_a6c830742ef90306cfdba7a9be7899400"><div class="ttname"><a href="classIoCore.html#a6c830742ef90306cfdba7a9be7899400">IoCore::InitAcceptor</a></div><div class="ttdeci">void InitAcceptor(const std::string &amp;address, const std::string &amp;port)</div><div class="ttdoc">Initialises a TCP acceptor on the given address and port. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00349">io.cpp:349</a></div></div>
<div class="ttc" id="classIoCore_html_a51fc6a9ab76b2bdaea592ff1d4cfcdac"><div class="ttname"><a href="classIoCore.html#a51fc6a9ab76b2bdaea592ff1d4cfcdac">IoCore::InitUpdateTimer</a></div><div class="ttdeci">void InitUpdateTimer()</div><div class="ttdoc">Sets up a periodic timer to run the playd update loop. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00338">io.cpp:338</a></div></div>
<div class="ttc" id="classInternalError_html"><div class="ttname"><a href="classInternalError.html">InternalError</a></div><div class="ttdoc">An Error signifying that playd has hit an internal snag. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00060">errors.hpp:60</a></div></div>
<div class="ttc" id="classIoCore_html_aca09f696d0ca9583be54802a954020bb"><div class="ttname"><a href="classIoCore.html#aca09f696d0ca9583be54802a954020bb">IoCore::loop</a></div><div class="ttdeci">uv_loop_t * loop</div><div class="ttdoc">The loop this IoCore is using. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00106">io.hpp:106</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f3728ba1217431a57326641922eeb04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f3728ba1217431a57326641922eeb04">&sect;&nbsp;</a></span>Unicast()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::Unicast </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classResponse.html">Response</a> &amp;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends the given response to the identified connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>The ID of the recipient connection. </td></tr>
    <tr><td class="paramname">response</td><td>The response to broadcast. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00327">327</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="response_8cpp_source.html#l00044">Response::Pack()</a>, and <a class="el" href="io_8hpp_source.html#l00114">pool</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00305">Respond()</a>.</p>
<div class="fragment"><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;{</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    assert(0 &lt; <span class="keywordtype">id</span> &amp;&amp; id &lt;= this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.size());</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="classDebug.html">Debug</a>() &lt;&lt; <span class="stringliteral">&quot;unicast @&quot;</span> &lt;&lt; std::to_string(<span class="keywordtype">id</span>) &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; response.<a class="code" href="classResponse.html#a38600396348b60b90720bb92a058d9b3">Pack</a>()</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            &lt;&lt; std::endl;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keyword">auto</span> c = this-&gt;<a class="code" href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">pool</a>.at(<span class="keywordtype">id</span> - 1);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (c) c-&gt;Respond(response);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div><div class="ttc" id="classResponse_html_a38600396348b60b90720bb92a058d9b3"><div class="ttname"><a href="classResponse.html#a38600396348b60b90720bb92a058d9b3">Response::Pack</a></div><div class="ttdeci">std::string Pack() const</div><div class="ttdoc">Packs the Response, converting it to a BAPS3 protocol message. </div><div class="ttdef"><b>Definition:</b> <a href="response_8cpp_source.html#l00044">response.cpp:44</a></div></div>
<div class="ttc" id="classIoCore_html_a54e99d116bd905271babb7c9e21d35d8"><div class="ttname"><a href="classIoCore.html#a54e99d116bd905271babb7c9e21d35d8">IoCore::pool</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; Connection &gt; &gt; pool</div><div class="ttdoc">The set of connections inside this IoCore. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00114">io.hpp:114</a></div></div>
<div class="ttc" id="classDebug_html"><div class="ttname"><a href="classDebug.html">Debug</a></div><div class="ttdoc">Class for telling the human what playd is doing. </div><div class="ttdef"><b>Definition:</b> <a href="errors_8hpp_source.html#l00133">errors.hpp:133</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ffe03e64cde25b0f85a0b48708f6024"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ffe03e64cde25b0f85a0b48708f6024">&sect;&nbsp;</a></span>UpdatePlayer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IoCore::UpdatePlayer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a player update cycle. </p>
<p>If the player is closing, <a class="el" href="classIoCore.html" title="The IO core, which services input, routes responses, and executes the Player update routine periodica...">IoCore</a> will announce this fact to all current connections, close them, and end the I/O loop. </p>

<p>Definition at line <a class="el" href="io_8cpp_source.html#l00274">274</a> of file <a class="el" href="io_8cpp_source.html">io.cpp</a>.</p>

<p>References <a class="el" href="io_8hpp_source.html#l00111">player</a>, <a class="el" href="io_8cpp_source.html#l00280">Shutdown()</a>, and <a class="el" href="player_8cpp_source.html#l00041">Player::Update()</a>.</p>
<div class="fragment"><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordtype">bool</span> running = this-&gt;<a class="code" href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">player</a>.<a class="code" href="classPlayer.html#a91f887a024035be5030aa4b3384705fa">Update</a>();</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">if</span> (!running) this-&gt;<a class="code" href="classIoCore.html#a7896b8a28b0cb6758cd1e3064485860f">Shutdown</a>();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;}</div><div class="ttc" id="classPlayer_html_a91f887a024035be5030aa4b3384705fa"><div class="ttname"><a href="classPlayer.html#a91f887a024035be5030aa4b3384705fa">Player::Update</a></div><div class="ttdeci">bool Update()</div><div class="ttdoc">Instructs the Player to perform a cycle of work. </div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l00041">player.cpp:41</a></div></div>
<div class="ttc" id="classIoCore_html_af5d296ab190bb4f39e1f8195c464c68a"><div class="ttname"><a href="classIoCore.html#af5d296ab190bb4f39e1f8195c464c68a">IoCore::player</a></div><div class="ttdeci">Player &amp; player</div><div class="ttdoc">The player. </div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00111">io.hpp:111</a></div></div>
<div class="ttc" id="classIoCore_html_a7896b8a28b0cb6758cd1e3064485860f"><div class="ttname"><a href="classIoCore.html#a7896b8a28b0cb6758cd1e3064485860f">IoCore::Shutdown</a></div><div class="ttdeci">void Shutdown()</div><div class="ttdoc">Shuts down the IoCore by terminating all IO loop tasks. </div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00280">io.cpp:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a50119d91a07d6e7a9380226197e83424"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50119d91a07d6e7a9380226197e83424">&sect;&nbsp;</a></span>free_list</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;size_t&gt; IoCore::free_list</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A list of free 1-indexed slots inside pool. </p>
<p>These slots may be re-used instead of creating a new slot. </p>

<p>Definition at line <a class="el" href="io_8hpp_source.html#l00118">118</a> of file <a class="el" href="io_8hpp_source.html">io.hpp</a>.</p>

<p>Referenced by <a class="el" href="io_8cpp_source.html#l00243">ExpandPool()</a>, <a class="el" href="io_8cpp_source.html#l00223">NextConnectionID()</a>, and <a class="el" href="io_8cpp_source.html#l00260">Remove()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="io_8hpp_source.html">io.hpp</a></li>
<li>src/<a class="el" href="io_8cpp_source.html">io.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classIoCore.html">IoCore</a></li>
    <li class="footer">Generated on Mon Sep 12 2016 21:01:22 for URY playd by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
